ngs_logging_version="1.0.9";ngs_event_create_url="http://web-appledaily-hk-logging.nextmedia.com/appledailyhk/v1/event_create.jsonp";ngs_platform="web";ngs_video_session_id=device_id=null;function setNGSUdid(a){device_id=a}function setNGSUrl(a){ngs_event_create_url=a}function setNGSPlatform(a){ngs_platform=a}function getNGSLoggingVersion(){return ngs_logging_version}
function ngsLogVideo(a,b,c,d,n,s,k,f,g,e,l,m,h){updateConfig(b,a);c&&""!=c||(c="0");a=null;try{a="undefined"==typeof h?$f(0):$("div#"+h+" div").flowplayer(0)}catch(p){}a&&!a.clipSet&&(a.clipSet=!0,a.video_id=c,a.video_title=d,a.category_id=n,a.category_title=s,a.article_id=k,a.article_title=f,a.onStart(function(a){video_session_id=createVideoSessionID();if(!a.cuepointAlreadySet){a.cuepointAlreadySet=!0;var b=a.fullDuration;clip_duration=1E3*b;view_duration=Math.round(b);a.onCuepoint([Math.round(.25*
clip_duration),Math.round(.5*clip_duration),Math.round(.75*clip_duration),Math.round(clip_duration)-300],function(a,b){var d=Math.round(b/1E3),c=Math.round(b/clip_duration*100);30>c?c=25:55>c?c=50:80>c?c=75:(c=100,d=view_duration);device_id&&ngsLogVideoByPercent("","",this.video_id,this.video_title,this.category_id,this.category_title,this.article_id,this.article_title,c,d,view_duration,video_session_id,g,e,l,m)})}device_id&&ngsLogVideoByPercent("","",this.video_id,this.video_title,this.category_id,
this.category_title,this.article_id,this.article_title,0,0,view_duration,video_session_id,g,e,l,m)}));try{a="undefined"==typeof h?document.getElementsByTagName("video")[0]:document.getElementById(h)}catch(r){}}
function ngsLogVideoByPercent(a,b,c,d,n,s,k,f,g,e,l,m,h,p,r,t,q){updateConfig(b,a);c&&""!=c||(c="0");a="";"undefined"!=typeof h&&(a=h);"undefined"!=typeof p&&""!=p&&(ngs_platform=p);h="";"undefined"!=typeof r&&(h=r);r="";"undefined"!=typeof t&&(r=t);b=p=t="";"undefined"!=typeof q&&(t=q.hasOwnProperty("article_type")?q.article_type:"",p=q.hasOwnProperty("sub_menu")?q.sub_menu:"",b=q.hasOwnProperty("sub_menu_id")?q.sub_menu_id:"");device_id&&$.ajax({url:ngs_event_create_url,type:"GET",dataType:"jsonp",
async:!0,data:{udid:device_id,event:"video_view",json:JSON.stringify({type:t,smenu:p,smenuid:b,datetime:(new Date).getTime(),video_id:c,video_title:d,video_category_id:n,video_category:s,view_through:g+"%",view_through_sec:e,seconds:l,article_id:k,article_title:f,page_name:decodeURI(document.URL),issue:a,platform:ngs_platform,session_id:m,video_quality:h,thumbnail_url:r,gigya_uid:$.cookie("gigya_uid")}),r:Math.random()}})}
function ngsVideoPlayerLog(a,b){if("undefined"!=typeof b&&null!=b){var c="video_view";2<arguments.length&&(c=arguments[2]);updateConfig("","");var d=genVideoLogData(a,b,c);if(null!=d.seconds&&device_id){var n=d.r;delete d.r;d.gigya_uid=$.cookie("gigya_uid");$.ajax({url:ngs_event_create_url,type:"GET",dataType:"jsonp",async:!0,data:{udid:device_id,event:c,"long":getParameterByName("longitude"),lat:getParameterByName("latitude"),json:JSON.stringify(d),r:n},success:function(a){},error:function(a,b,c){}})}return d}}
function getViewThroughArray(a){var b=["undefined","undefined","undefined"];if(-1!=a.indexOf("playerviewthrough")){a=a.split("-")[1].split(",");for(var c=0;3>c;c++)a.length>c&&(b[c]=a[c])}return b}
function videoDataDefault(a){a=getViewThroughArray(a);if("0%"==a[0]||""==ngs_video_session_id)ngs_video_session_id=getUdid()+(new Date).getTime();delete a;return{r:Math.random(),datetime:(new Date).getTime(),session_id:ngs_video_session_id,article_id:"",article_title:"",view_through:"",view_through_sec:"",seconds:"",page_name:decodeURI(document.URL),platform:ngs_platform}}
function genVideoLogData(a,b,c){var d=videoDataDefault(a);a=getViewThroughArray(a);"audio_view"==c?(d.audio_id=b.hasOwnProperty("ngs_audio_id")?b.ngs_audio_id:b.ngs_video_id,d.audio_title=b.hasOwnProperty("ngs_audio_title")?b.ngs_audio_title:b.ngs_video_title,d.audio_category_id=b.ngs_catid,d.audio_category=b.ngs_cat_title):(d.video_id=b.ngs_video_id,d.video_title=b.ngs_video_title,d.video_category_id=b.ngs_catid,d.video_category=b.ngs_cat_title);d.view_through="undefined"==a[0]?"0%":a[0];d.view_through_sec=
"undefined"==a[1]?"0":a[1];d.seconds="undefined"==a[2]?0:a[2];d.article_id=b.ngs_art_id;d.article_title=b.ngs_art_title;d.issue=b.ngs_issue;d.pcatid=b.ngs_catid;d.pcat=b.ngs_cat_title;b.hasOwnProperty("ngs_extra")&&$.each(b.ngs_extra,function(a,b){"sub_menu_id"==a?a="smenuid":"sub_menu"==a?a="smenu":"article_type"==a&&(a="type");d[a]=b});return d}
function getParameterByName(a){a=a.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]");a=(new RegExp("[\\?&]"+a+"=([^&#]*)")).exec(location.search);return null==a?"":decodeURIComponent(a[1].replace(/\+/g," "))}
function ngsLogPage(a,b,c,d,n,s,k,f,g,e){updateConfig(b,a);a="";"undefined"!=typeof k&&(a=k);"undefined"!=typeof f&&""!=f&&(ngs_platform=f);k="";"undefined"!=typeof g&&(k=g);b=f=g="";var l=getParameterByName("latitude"),m=getParameterByName("longitude");"undefined"!=typeof e&&(g=e.hasOwnProperty("article_type")?e.article_type:"",f=e.hasOwnProperty("sub_menu")?e.sub_menu:"",b=e.hasOwnProperty("sub_menu_id")?e.sub_menu_id:"",l=0==l.length&&e.hasOwnProperty("latitude")?e.latitude:l,m=0==m.length&&e.hasOwnProperty("longitude")?
e.longitude:m);device_id&&$.ajax({url:ngs_event_create_url,type:"GET",dataType:"jsonp",async:!0,data:{udid:device_id,event:"page_view",json:JSON.stringify({type:g,smenu:f,smenuid:b,top:getParameterByName("top"),datetime:(new Date).getTime(),article_id:c,article_title:d,article_category_id:n,article_category:s,page_name:decodeURI(document.URL),issue:a,platform:ngs_platform,thumbnail_url:k,"long":m,lat:l,gigya_uid:$.cookie("gigya_uid")}),r:Math.random()}})}
function getUdid(){var a=$.cookie("udid"),b=$.cookie("udid_ver");if(!(void 0!=a&&null!=a&&a&&""!=a&&void 0!=b&&null!=b&&b&&""!=b&&1<=b))try{a=(new Fingerprint).get()+"",10>a.length&&(a="0000000000"+a,a=a.substr(a.length-10)),$.cookie("udid",a,{expires:36500,domian:document.domain,path:"/"}),$.cookie("udid_ver",1,{expires:36500,domian:document.domain,path:"/"})}catch(c){a="0000000000"}return a}function createVideoSessionID(){return getUdid()+(new Date).getTime()}
function check_support_cookie(){var a=!1;$.cookie("test_cookie_test","test_cookie");"test_cookie"==$.cookie("test_cookie_test")&&(a=!0);$.removeCookie("test_cookie_test");return a}
function ngsLogAppStart(a,b){try{if(check_support_cookie()){var c=$.cookie("app_alreay_start");void 0!=c&&null!=c&&c&&""!=c||(updateConfig(b,a),$.cookie("app_alreay_start","1",{domian:document.domain,path:"/"}),device_id&&$.ajax({url:ngs_event_create_url,type:"GET",dataType:"jsonp",async:!0,data:{udid:device_id,event:"app_start",platform:ngs_platform,json:JSON.stringify({datetime:(new Date).getTime()}),r:Math.random()}}))}}catch(d){}}
function updateConfig(a,b){device_id=a&&""!=a?a:getUdid();b&&""!=b&&(ngs_event_create_url=b)}$(document).ready(function(){ngsLogAppStart("","")});